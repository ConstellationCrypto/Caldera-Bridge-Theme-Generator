<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), clipboard-write=(), display-capture=()">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      padding: 20px;
      background: #ffffff;
      height: 600px;
      overflow-y: auto;
    }
    
    h1 {
      font-size: 18px;
      margin-bottom: 20px;
      color: #1a1a1a;
    }
    
    h2 {
      font-size: 14px;
      margin-top: 24px;
      margin-bottom: 12px;
      color: #333;
      border-bottom: 1px solid #e0e0e0;
      padding-bottom: 4px;
    }
    
    .input-group {
      margin-bottom: 16px;
    }
    
    label {
      display: block;
      font-size: 14px;
      margin-bottom: 6px;
      color: #333;
      font-weight: 500;
    }
    
    .required::after {
      content: " *";
      color: #ff4444;
    }
    
    .optional {
      color: #999;
      font-weight: normal;
    }
    
    input[type="text"], input[type="color"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
    }
    
    .color-input-wrapper {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    input[type="color"] {
      width: 50px;
      height: 42px;
      border-radius: 6px;
      cursor: pointer;
      border: 1px solid #e0e0e0;
    }
    
    input[type="text"] {
      flex: 1;
    }
    
    .slider-container {
      margin: 8px 0;
    }
    
    input[type="range"] {
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: #e0e0e0;
      outline: none;
      -webkit-appearance: none;
      appearance: none;
    }
    
    input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #0066ff;
      cursor: pointer;
      border: 2px solid white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    
    input[type="range"]::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #0066ff;
      cursor: pointer;
      border: 2px solid white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    
    .slider-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 8px;
      font-size: 11px;
      color: #666;
    }
    
    .button-group {
      display: flex;
      gap: 12px;
      margin-top: 32px;
      position: sticky;
      bottom: 0;
      background: white;
      padding: 12px 0;
      border-top: 1px solid #e0e0e0;
    }
    
    button {
      flex: 1;
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .primary {
      background: #0066ff;
      color: white;
    }
    
    .primary:hover {
      background: #0052cc;
      transform: translateY(-1px);
    }
    
    .secondary {
      background: #f5f5f5;
      color: #333;
      border: 1px solid #e0e0e0;
    }
    
    .secondary:hover {
      background: #e8e8e8;
    }
    
    .info-box {
      background: #f0f6ff;
      border: 1px solid #b3d4ff;
      border-radius: 6px;
      padding: 16px;
      font-size: 13px;
      color: #0052cc;
      margin-bottom: 24px;
      line-height: 1.4;
    }
    
    .description {
      font-size: 12px;
      color: #666;
      margin-top: 6px;
      line-height: 1.3;
    }
  </style>
</head>
<body>
  <h1>Bridge Theme Generator</h1>
  
  <div class="info-box">
    Generate a complete design system from a primary color. Optionally override neutral and status colors for more control.
  </div>
  
  <div class="input-group">
    <label class="required">Primary Color</label>
    <div class="color-input-wrapper">
      <input type="color" id="primary-color" value="#0066ff">
      <input type="text" id="primary-hex" value="#0066ff" placeholder="#0066ff">
    </div>
    <div class="description">
      Your brand's primary color. This will be used exactly as specified.
    </div>
  </div>
  
  <h2>Optional Overrides</h2>
  
  <div class="input-group">
    <label>Neutral Color <span class="optional">(optional)</span></label>
    <div class="color-input-wrapper">
      <input type="color" id="neutral-color" value="#666666">
      <input type="text" id="neutral-hex" value="" placeholder="Auto-generated from primary">
    </div>
    <div class="description">
      Override the auto-generated neutral palette base color.
    </div>
  </div>
  
  <div class="input-group">
    <label>Success Color <span class="optional">(optional)</span></label>
    <div class="color-input-wrapper">
      <input type="color" id="success-color" value="#22c55e">
      <input type="text" id="success-hex" value="" placeholder="#22c55e">
    </div>
    <div class="description">
      Override the default success/positive color.
    </div>
  </div>
  
  <div class="input-group">
    <label>Warning Color <span class="optional">(optional)</span></label>
    <div class="color-input-wrapper">
      <input type="color" id="warning-color" value="#f59e0b">
      <input type="text" id="warning-hex" value="" placeholder="#f59e0b">
    </div>
    <div class="description">
      Override the default warning/caution color.
    </div>
  </div>
  
  <div class="input-group">
    <label>Info Color <span class="optional">(optional)</span></label>
    <div class="color-input-wrapper">
      <input type="color" id="info-color" value="#3b82f6">
      <input type="text" id="info-hex" value="" placeholder="#3b82f6">
    </div>
    <div class="description">
      Override the default info/neutral status color.
    </div>
  </div>
  
  <div class="input-group">
    <label>Error Color <span class="optional">(optional)</span></label>
    <div class="color-input-wrapper">
      <input type="color" id="error-color" value="#ef4444">
      <input type="text" id="error-hex" value="" placeholder="#ef4444">
    </div>
    <div class="description">
      Override the default error/failure color.
    </div>
  </div>
  
  <h2>Theme Settings</h2>
  
  <div class="input-group">
    <label>Corner Radius Style</label>
    <div class="slider-container">
      <input type="range" id="corner-radius-slider" min="0" max="4" value="3" step="1">
      <div class="slider-labels">
        <span>None</span>
        <span>Minimal</span>
        <span>Soft</span>
        <span>Default</span>
        <span>Round</span>
      </div>
    </div>
    <div class="description" id="corner-description">
      Default: Balanced corner radius for most interfaces (2, 4, 8, 16, 24, 48)
    </div>
  </div>

  <div class="button-group">
    <button class="primary" id="generate">Generate Theme</button>
    <button class="secondary" id="export">Export JSON</button>
  </div>
  
  <script>
    // Color input pairs
    const colorPairs = [
      { color: 'primary-color', hex: 'primary-hex' },
      { color: 'neutral-color', hex: 'neutral-hex' },
      { color: 'success-color', hex: 'success-hex' },
      { color: 'warning-color', hex: 'warning-hex' },
      { color: 'info-color', hex: 'info-hex' },
      { color: 'error-color', hex: 'error-hex' }
    ];
    
    // Sync color inputs
    colorPairs.forEach(pair => {
      const colorInput = document.getElementById(pair.color);
      const hexInput = document.getElementById(pair.hex);
      
      colorInput.addEventListener('input', (e) => {
        hexInput.value = e.target.value;
      });
      
      hexInput.addEventListener('input', (e) => {
        const value = e.target.value;
        if (value && isValidHex(value)) {
          colorInput.value = value;
        }
      });
    });
    
    // Corner radius slider
    const cornerSlider = document.getElementById('corner-radius-slider');
    const cornerDescription = document.getElementById('corner-description');
    
    const cornerDescriptions = [
      'None: No rounded corners (0, 0, 0, 0, 0, 0)',
      'Minimal: Subtle corners (2, 2, 2, 2, 2, 2)', 
      'Soft: Gentle curves (0, 2, 4, 8, 12, 16)',
      'Default: Balanced corner radius for most interfaces (2, 4, 8, 16, 24, 48)',
      'Round: Bold, modern rounded corners (2, 8, 16, 24, 48, 96)'
    ];
    
    cornerSlider.addEventListener('input', (e) => {
      const level = parseInt(e.target.value);
      cornerDescription.textContent = cornerDescriptions[level];
    });
    
    // Validate hex color format
    function isValidHex(hex) {
      return /^#[0-9A-F]{6}$/i.test(hex);
    }
    
    // Generate button
    document.getElementById('generate').onclick = () => {
      const primaryHex = document.getElementById('primary-hex').value;
      
      // Validate primary color
      if (!isValidHex(primaryHex)) {
        alert('Please enter a valid primary color (e.g., #0066ff)');
        return;
      }
      
      // Get optional colors
      const neutralHex = document.getElementById('neutral-hex').value;
      const successHex = document.getElementById('success-hex').value;
      const warningHex = document.getElementById('warning-hex').value;
      const infoHex = document.getElementById('info-hex').value;
      const errorHex = document.getElementById('error-hex').value;
      
      // Validate optional colors if provided
      const optionalColors = [
        { name: 'neutral', value: neutralHex },
        { name: 'success', value: successHex },
        { name: 'warning', value: warningHex },
        { name: 'info', value: infoHex },
        { name: 'error', value: errorHex }
      ];
      
      for (const color of optionalColors) {
        if (color.value && !isValidHex(color.value)) {
          alert(`Please enter a valid ${color.name} color or leave it empty`);
          return;
        }
      }
      
      // Get corner radius setting
      const cornerRadiusLevel = parseInt(document.getElementById('corner-radius-slider').value);
      
      parent.postMessage({
        pluginMessage: {
          type: 'generate-theme',
          hex: primaryHex,
          neutralHex: neutralHex || undefined,
          successHex: successHex || undefined,
          warningHex: warningHex || undefined,
          infoHex: infoHex || undefined,
          errorHex: errorHex || undefined,
          cornerRadiusLevel: cornerRadiusLevel
        }
      }, '*');
    };
    
    // Export button
    document.getElementById('export').onclick = () => {
      parent.postMessage({
        pluginMessage: { type: 'export-json' }
      }, '*');
    };
    
    // Handle messages from plugin
    window.onmessage = (event) => {
      const msg = event.data.pluginMessage;
      if (msg && msg.type === 'generation-complete') {
        console.log('Theme generated successfully!');
      }
      if (msg && msg.type === 'export-data') {
        // Create and download the JSON file
        const blob = new Blob([msg.jsonData], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = msg.filename || 'theme-export.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        console.log('Theme exported successfully!');
      }
    };
  </script>
</body>
</html>