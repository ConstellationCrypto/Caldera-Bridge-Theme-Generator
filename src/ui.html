<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), clipboard-write=(), display-capture=()">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      padding: 20px;
      background: #ffffff;
      min-height: 100vh;
      overflow-y: auto;
    }
    
    h1 {
      font-size: 18px;
      margin-bottom: 20px;
      color: #1a1a1a;
    }
    
    h2 {
      font-size: 14px;
      margin-top: 24px;
      margin-bottom: 12px;
      color: #333;
      border-bottom: 1px solid #e0e0e0;
      padding-bottom: 4px;
    }
    
    .collapsible-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      user-select: none;
      transition: color 0.2s ease;
    }
    
    .collapsible-header:hover {
      color: #007aff;
    }
    
    .collapse-icon {
      font-size: 12px;
      transition: transform 0.2s ease;
      color: #666;
    }
    
    .collapse-icon.collapsed {
      transform: rotate(-90deg);
    }
    
    .collapsible-content {
      overflow: hidden;
      transition: max-height 0.3s ease-out;
    }
    
    .collapsible-content.collapsed {
      max-height: 0;
    }
    
    .collapsible-content:not(.collapsed) {
      max-height: 2000px; /* Large enough for content */
    }
    
    .input-group {
      margin-bottom: 16px;
    }
    
    label {
      display: block;
      font-size: 14px;
      margin-bottom: 6px;
      color: #333;
      font-weight: 500;
    }
    
    .required::after {
      content: " *";
      color: #ff4444;
    }
    
    .optional {
      color: #999;
      font-weight: normal;
    }
    
    input[type="text"], input[type="color"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
    }
    
    .color-input-wrapper {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    input[type="color"] {
      width: 50px;
      height: 42px;
      border-radius: 6px;
      cursor: pointer;
      border: 1px solid #e0e0e0;
    }
    
    input[type="text"] {
      flex: 1;
    }
    
    .slider-container {
      margin: 8px 0;
    }
    
    input[type="range"] {
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: #e0e0e0;
      outline: none;
      -webkit-appearance: none;
      appearance: none;
    }
    
    input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #0066ff;
      cursor: pointer;
      border: 2px solid white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    
    input[type="range"]::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #0066ff;
      cursor: pointer;
      border: 2px solid white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    
    .slider-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 8px;
      font-size: 11px;
      color: #666;
    }
    
    .button-group {
      display: flex;
      gap: 12px;
      margin-top: 32px;
      position: sticky;
      bottom: 0;
      background: white;
      padding: 12px 0;
      border-top: 1px solid #e0e0e0;
      z-index: 10;
    }
    
    button {
      flex: 1;
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .primary {
      background: #0066ff;
      color: white;
    }
    
    .primary:hover {
      background: #0052cc;
      transform: translateY(-1px);
    }
    
    .secondary {
      background: #f5f5f5;
      color: #333;
      border: 1px solid #e0e0e0;
    }
    
    .secondary:hover {
      background: #e8e8e8;
    }
    
    .info-box {
      background: #f0f6ff;
      border: 1px solid #b3d4ff;
      border-radius: 6px;
      padding: 16px;
      font-size: 13px;
      color: #0052cc;
      margin-bottom: 24px;
      line-height: 1.4;
    }
    
    .description {
      font-size: 12px;
      color: #666;
      margin-top: 6px;
      line-height: 1.3;
    }
  </style>
</head>
<body>
  <h1>Bridge Theme Generator</h1>
  
  <div class="info-box">
    Generate a complete design system from a primary color. Optionally override neutral and status colors for more control.
  </div>
  
  <div class="input-group">
    <label class="required">Primary Color</label>
    <div class="color-input-wrapper">
      <input type="color" id="primary-color" value="#0066ff">
      <input type="text" id="primary-hex" value="#0066ff" placeholder="#0066ff">
    </div>
    <div class="description">
      Your brand's primary color. This will be used exactly as specified.
    </div>
  </div>
  
  <h2 class="collapsible-header" onclick="toggleSection('optional-overrides')">
    <span>Optional Overrides</span>
    <span class="collapse-icon">▼</span>
  </h2>
  
  <div class="collapsible-content collapsed" id="optional-overrides-content">
  <div class="input-group">
    <label>Neutral Color <span class="optional">(optional)</span></label>
    <div class="color-input-wrapper">
      <input type="color" id="neutral-color" value="#666666">
      <input type="text" id="neutral-hex" value="" placeholder="Auto-generated from primary">
    </div>
    <div class="description">
      Override the auto-generated neutral palette base color.
    </div>
  </div>
  
  <div class="input-group">
    <label>Success Color <span class="optional">(optional)</span></label>
    <div class="color-input-wrapper">
      <input type="color" id="success-color" value="#22c55e">
      <input type="text" id="success-hex" value="" placeholder="#22c55e">
    </div>
    <div class="description">
      Override the default success/positive color.
    </div>
  </div>
  
  <div class="input-group">
    <label>Warning Color <span class="optional">(optional)</span></label>
    <div class="color-input-wrapper">
      <input type="color" id="warning-color" value="#f59e0b">
      <input type="text" id="warning-hex" value="" placeholder="#f59e0b">
    </div>
    <div class="description">
      Override the default warning/caution color.
    </div>
  </div>
  
  <div class="input-group">
    <label>Info Color <span class="optional">(optional)</span></label>
    <div class="color-input-wrapper">
      <input type="color" id="info-color" value="#3b82f6">
      <input type="text" id="info-hex" value="" placeholder="#3b82f6">
    </div>
    <div class="description">
      Override the default info/neutral status color.
    </div>
  </div>
  
  <div class="input-group">
    <label>Failure Color <span class="optional">(optional)</span></label>
    <div class="color-input-wrapper">
      <input type="color" id="failure-color" value="#ef4444">
      <input type="text" id="failure-hex" value="" placeholder="#ef4444">
    </div>
    <div class="description">
      Override the default failure/error color.
    </div>
  </div>
  </div> <!-- End Optional Overrides collapsible content -->
  
  <h2 class="collapsible-header" onclick="toggleSection('typography')">
    <span>Typography</span>
    <span class="collapse-icon">▼</span>
  </h2>

<div class="collapsible-content collapsed" id="typography-content">
<div class="input-group">
  <label>Display Font <span class="optional">(optional)</span></label>
  <div style="display: flex; flex-direction: column; gap: 8px;">
    <select id="display-font-family" style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 6px;">
      <option value="">Loading fonts...</option>
    </select>
    <select id="display-font-style" style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 6px;" disabled>
      <option value="">Select style...</option>
    </select>
  </div>
  <div class="description">
    Font for large display text and headlines.
  </div>
</div>

<div class="input-group">
  <label>Header Font <span class="optional">(optional)</span></label>
  <div style="display: flex; flex-direction: column; gap: 8px;">
    <select id="header-font-family" style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 6px;">
      <option value="">Loading fonts...</option>
    </select>
    <select id="header-font-style" style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 6px;" disabled>
      <option value="">Select style...</option>
    </select>
  </div>
  <div class="description">
    Font for section headers and titles.
  </div>
</div>

<div class="input-group">
  <label>Primary Font <span class="optional">(optional)</span></label>
  <div style="display: flex; flex-direction: column; gap: 8px;">
    <select id="primary-font-family" style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 6px;">
      <option value="">Loading fonts...</option>
    </select>
    <select id="primary-font-style" style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 6px;" disabled>
      <option value="">Select style...</option>
    </select>
  </div>
  <div class="description">
    Font for body text and general content.
  </div>
</div>

<div class="input-group">
  <label>Data Font <span class="optional">(optional)</span></label>
  <div style="display: flex; flex-direction: column; gap: 8px;">
    <select id="data-font-family" style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 6px;">
      <option value="">Loading fonts...</option>
    </select>
    <select id="data-font-style" style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 6px;" disabled>
      <option value="">Select style...</option>
    </select>
  </div>
  <div class="description">
    Monospace font for code, data, and technical content.
  </div>
</div>
</div> <!-- End Typography collapsible content -->
  
  <h2 class="collapsible-header" onclick="toggleSection('theme-settings')">
    <span>Theme Settings</span>
    <span class="collapse-icon">▼</span>
  </h2>
  
  <div class="collapsible-content collapsed" id="theme-settings-content">
  <div class="input-group">
    <label>Corner Radius Style</label>
    <div class="slider-container">
      <input type="range" id="corner-radius-slider" min="0" max="4" value="3" step="1">
      <div class="slider-labels">
        <span>None</span>
        <span>Minimal</span>
        <span>Soft</span>
        <span>Default</span>
        <span>Round</span>
      </div>
    </div>
    <div class="description" id="corner-description">
      Default: Balanced corner radius for most interfaces (2, 4, 8, 16, 24, 48)
    </div>
  </div>

  <div class="input-group">
    <label>Modal Background</label>
    <div class="toggle-container" style="display: flex; align-items: center; gap: 12px;">
      <input type="checkbox" id="modal-background-toggle" checked>
      <label for="modal-background-toggle" style="margin: 0; cursor: pointer;">Show background</label>
    </div>
    <div class="description">
      Toggle modal background visibility. When unchecked, modal background becomes transparent.
    </div>
  </div>

  <div class="input-group" id="modal-padding-group">
    <label>Modal Padding</label>
    <select id="modal-padding-select" style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 6px;">
      <option value="2" selected>2 (16px)</option>
      <option value="1">1 (8px)</option>
      <option value="3">3 (24px)</option>
      <option value="4">4 (32px)</option>
      <option value="5">5 (40px)</option>
      <option value="6">6 (48px)</option>
      <option value="7">7 (56px)</option>
      <option value="8">8 (64px)</option>
      <option value="9">9 (72px)</option>
      <option value="10">10 (80px)</option>
      <option value="11">11 (88px)</option>
      <option value="12">12 (96px)</option>
    </select>
    <div class="description">
      Select padding size for modal content when background is enabled.
    </div>
  </div>

  <div class="input-group">
    <label>Header/Icons Pairing</label>
    <div class="toggle-container" style="display: flex; align-items: center; gap: 12px;">
      <input type="checkbox" id="header-icons-pairing-toggle" checked>
      <label for="header-icons-pairing-toggle" style="margin: 0; cursor: pointer;">Enable header/icons pairing</label>
    </div>
    <div class="description">
      Toggle whether headers and icons are paired together in the interface.
    </div>
  </div>

  <div class="input-group">
    <label>Header Background</label>
    <div class="toggle-container" style="display: flex; align-items: center; gap: 12px;">
      <input type="checkbox" id="header-background-toggle">
      <label for="header-background-toggle" style="margin: 0; cursor: pointer;">Show header background</label>
    </div>
    <div class="description">
      Toggle header background visibility. When unchecked, header background becomes transparent.
    </div>
  </div>
  </div> <!-- End Theme Settings collapsible content -->

  <div class="button-group">
    <button class="primary" id="generate">Generate Theme</button>
    <button class="secondary" id="export">Export JSON</button>
  </div>
  
  <script>
    // Collapsible sections functionality
    function toggleSection(sectionId) {
      const content = document.getElementById(sectionId + '-content');
      const icon = document.querySelector(`[onclick="toggleSection('${sectionId}')"] .collapse-icon`);
      
      if (content.classList.contains('collapsed')) {
        content.classList.remove('collapsed');
        icon.classList.remove('collapsed');
        icon.textContent = '▼';
      } else {
        content.classList.add('collapsed');
        icon.classList.add('collapsed');
        icon.textContent = '▶';
      }
    }

    // Font management
    let availableFonts = {};

    // Request fonts from Figma on page load
    document.addEventListener('DOMContentLoaded', () => {
      parent.postMessage({
        pluginMessage: { type: 'load-fonts' }
      }, '*');
    });

    // Color input pairs
    const colorPairs = [
      { color: 'primary-color', hex: 'primary-hex' },
      { color: 'neutral-color', hex: 'neutral-hex' },
      { color: 'success-color', hex: 'success-hex' },
      { color: 'warning-color', hex: 'warning-hex' },
      { color: 'info-color', hex: 'info-hex' },
      { color: 'failure-color', hex: 'failure-hex' }
    ];

    // Sync color inputs
    colorPairs.forEach(pair => {
      const colorInput = document.getElementById(pair.color);
      const hexInput = document.getElementById(pair.hex);
      
      colorInput.addEventListener('input', (e) => {
        hexInput.value = e.target.value;
      });
      
      hexInput.addEventListener('input', (e) => {
        const value = e.target.value;
        if (value && isValidHex(value)) {
          colorInput.value = value;
        }
      });
    });

    // Corner radius slider
    const cornerSlider = document.getElementById('corner-radius-slider');
    const cornerDescription = document.getElementById('corner-description');
    
    const cornerDescriptions = [
      'None: No rounded corners (0, 0, 0, 0, 0, 0)',
      'Minimal: Subtle corners (2, 2, 2, 2, 2, 2)', 
      'Soft: Gentle curves (0, 2, 4, 8, 12, 16)',
      'Default: Balanced corner radius for most interfaces (2, 4, 8, 16, 24, 48)',
      'Round: Bold, modern rounded corners (2, 8, 16, 24, 48, 96)'
    ];
    
    cornerSlider.addEventListener('input', (e) => {
      const level = parseInt(e.target.value);
      cornerDescription.textContent = cornerDescriptions[level];
    });

    // Validate hex color format
    function isValidHex(hex) {
      return /^#[0-9A-F]{6}$/i.test(hex);
    }

    // Populate font dropdowns when fonts are loaded
    function populateFontDropdowns(fonts) {
      availableFonts = fonts;
      const fontTypes = ['display', 'header', 'primary', 'data'];
      
      fontTypes.forEach(type => {
        const familySelect = document.getElementById(`${type}-font-family`);
        const styleSelect = document.getElementById(`${type}-font-style`);
        
        // Clear loading state
        familySelect.innerHTML = '<option value="">Select font family...</option>';
        
        // Get font families, prioritizing common ones
        const commonFonts = ['Inter', 'Roboto', 'Open Sans', 'Lato', 'Montserrat', 'Poppins', 'Source Sans Pro', 'Nunito'];
        const monospaceFonts = ['Space Mono', 'Fira Code', 'Source Code Pro', 'JetBrains Mono', 'Roboto Mono', 'Ubuntu Mono', 'Inconsolata'];
        
        const fontFamilies = Object.keys(fonts).sort();
        
        // For data type, prioritize monospace fonts
        if (type === 'data') {
          monospaceFonts.forEach(font => {
            if (fonts[font]) {
              const option = document.createElement('option');
              option.value = font;
              option.textContent = font;
              familySelect.appendChild(option);
            }
          });
          
          // Add separator if we have monospace fonts
          if (monospaceFonts.some(font => fonts[font])) {
            const separator = document.createElement('option');
            separator.disabled = true;
            separator.textContent = '──────────────';
            familySelect.appendChild(separator);
          }
        } else {
          // For other types, prioritize common fonts
          commonFonts.forEach(font => {
            if (fonts[font]) {
              const option = document.createElement('option');
              option.value = font;
              option.textContent = font;
              familySelect.appendChild(option);
            }
          });
          
          // Add separator if we have common fonts
          if (commonFonts.some(font => fonts[font])) {
            const separator = document.createElement('option');
            separator.disabled = true;
            separator.textContent = '──────────────';
            familySelect.appendChild(separator);
          }
        }
        
        // Add all other fonts
        fontFamilies.forEach(family => {
          const isCommon = commonFonts.includes(family);
          const isMono = monospaceFonts.includes(family);
          
          if ((type === 'data' && !isMono) || (type !== 'data' && !isCommon)) {
            const option = document.createElement('option');
            option.value = family;
            option.textContent = family;
            familySelect.appendChild(option);
          }
        });
        
        // Handle family selection
        familySelect.addEventListener('change', (e) => {
          const family = e.target.value;
          styleSelect.innerHTML = '<option value="">Select style...</option>';
          
          if (family && fonts[family]) {
            styleSelect.disabled = false;
            
            fonts[family].forEach(style => {
              const option = document.createElement('option');
              option.value = style;
              option.textContent = style;
              styleSelect.appendChild(option);
            });
          } else {
            styleSelect.disabled = true;
          }
        });
      });
    }

    // Generate button
    document.getElementById('generate').onclick = () => {
      const primaryHex = document.getElementById('primary-hex').value;
      
      // Validate primary color
      if (!isValidHex(primaryHex)) {
        alert('Please enter a valid primary color (e.g., #0066ff)');
        return;
      }
      
      // Get optional colors
      const neutralHex = document.getElementById('neutral-hex').value;
      const successHex = document.getElementById('success-hex').value;
      const warningHex = document.getElementById('warning-hex').value;
      const infoHex = document.getElementById('info-hex').value;
      const failureHex = document.getElementById('failure-hex').value;
      
      // Validate optional colors if provided
      const optionalColors = [
        { name: 'neutral', value: neutralHex },
        { name: 'success', value: successHex },
        { name: 'warning', value: warningHex },
        { name: 'info', value: infoHex },
        { name: 'failure', value: failureHex }
      ];
      
      for (const color of optionalColors) {
        if (color.value && !isValidHex(color.value)) {
          alert(`Please enter a valid ${color.name} color or leave it empty`);
          return;
        }
      }
      
      // Get corner radius setting
      const cornerRadiusLevel = parseInt(document.getElementById('corner-radius-slider').value);
      
      // Get font selections
      const fontOverrides = {};
      ['display', 'header', 'primary', 'data'].forEach(type => {
        const family = document.getElementById(`${type}-font-family`).value;
        const style = document.getElementById(`${type}-font-style`).value;
        
        if (family && style) {
          fontOverrides[`${type}Font`] = { family, style };
        }
      });
      
      // Get modal background toggle state
      const modalBackgroundEnabled = document.getElementById('modal-background-toggle').checked;
      
      // Get modal padding selection (only relevant when background is enabled)
      const modalPaddingSize = document.getElementById('modal-padding-select').value;
      
      // Get header/icons pairing toggle state
      const headerIconsPairingEnabled = document.getElementById('header-icons-pairing-toggle').checked;
      
      // Get header background toggle state
      const headerBackgroundEnabled = document.getElementById('header-background-toggle').checked;
      
      parent.postMessage({
        pluginMessage: {
          type: 'generate-theme',
          hex: primaryHex,
          neutralHex: neutralHex || undefined,
          successHex: successHex || undefined,
          warningHex: warningHex || undefined,
          infoHex: infoHex || undefined,
          failureHex: failureHex || undefined,
          cornerRadiusLevel: cornerRadiusLevel,
          fontOverrides: fontOverrides,
          modalBackgroundEnabled: modalBackgroundEnabled,
          modalPaddingSize: modalPaddingSize,
          headerIconsPairingEnabled: headerIconsPairingEnabled,
          headerBackgroundEnabled: headerBackgroundEnabled
        }
      }, '*');
    };

    // Export button
    document.getElementById('export').onclick = () => {
      parent.postMessage({
        pluginMessage: { type: 'export-json' }
      }, '*');
    };

    // Toggle modal padding visibility based on background toggle
    function toggleModalPadding() {
      const backgroundEnabled = document.getElementById('modal-background-toggle').checked;
      const paddingGroup = document.getElementById('modal-padding-group');
      paddingGroup.style.display = backgroundEnabled ? 'block' : 'none';
    }
    
    // Set initial state and add event listener
    document.addEventListener('DOMContentLoaded', () => {
      toggleModalPadding();
      document.getElementById('modal-background-toggle').addEventListener('change', toggleModalPadding);
    });

    // Handle messages from plugin
    window.onmessage = (event) => {
      const msg = event.data.pluginMessage;
      
      if (msg && msg.type === 'fonts-loaded') {
        populateFontDropdowns(msg.fonts);
      }
      
      if (msg && msg.type === 'generation-complete') {
        console.log('Theme generated successfully!');
      }
      
      if (msg && msg.type === 'export-data') {
        // Create and download the JSON file
        const blob = new Blob([msg.jsonData], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = msg.filename || 'theme-export.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        console.log('Theme exported successfully!');
      }
    };
  </script>
</body>
</html>